<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Tones</title>
    <link rel="stylesheet" href="nutka.css" />
  </head>
  <body>
    <div id="sterowanie_i_kontrolki">
      <div id="kontrolki" style="display: inline-block"></div>
    </div>
    <script>
      function addArcSegmentWithMirror(
        parentContainer,
        cx,
        cy,
        r,
        startAngle,
        endAngle,
        strokeWidth,
        text,
        mirroredText
      ) {
        const svgNS = 'http://www.w3.org/2000/svg';

        // Helper function to create an arc
        function createArcPath(
          startAngle,
          endAngle,
          color,
          text,
          onClickCallback
        ) {
          const startRad = ((startAngle - 90) * Math.PI) / 180;
          const endRad = ((endAngle - 90) * Math.PI) / 180;

          // Calculate start and end points
          const x1 = cx + r * Math.cos(startRad);
          const y1 = cy + r * Math.sin(startRad);
          const x2 = cx + r * Math.cos(endRad);
          const y2 = cy + r * Math.sin(endRad);

          // Determine the large arc flag
          const largeArcFlag = endAngle - startAngle <= 180 ? 0 : 1;

          // Create the SVG path data
          const pathData = `M ${x1},${y1} A ${r},${r} 0 ${largeArcFlag} 1 ${x2},${y2}`;

          // Create the arc path
          const path = document.createElementNS(svgNS, 'path');
          path.setAttribute('d', pathData);
          path.setAttribute('fill', 'none');
          path.setAttribute('stroke', color);
          path.setAttribute('stroke-width', strokeWidth);
          path.setAttribute('stroke-linecap', 'round');
          path.addEventListener('click', onClickCallback);

          // Add the text centered on the arc
          const midAngle = (startRad + endRad) / 2;
          const textRadius = r; // Adjust text position to middle of arc
          const textX = cx + textRadius * Math.cos(midAngle);
          const textY = cy + textRadius * Math.sin(midAngle);

          const textElement = document.createElementNS(svgNS, 'text');
          textElement.setAttribute('x', textX);
          textElement.setAttribute('y', textY);
          textElement.setAttribute('text-anchor', 'middle');
          textElement.setAttribute('dominant-baseline', 'middle');
          textElement.setAttribute('fill', 'black');
          textElement.setAttribute('font-size', '18');
          textElement.textContent = text;

          return { path, textElement };
        }

        // Calculate SVG size and offsets for centering
        const padding = strokeWidth / 2;
        const svgSize = (r + padding) * 2;

        // Create the SVG container
        const svg = document.createElementNS(svgNS, 'svg');
        svg.setAttribute('width', svgSize);
        svg.setAttribute('height', svgSize);
        svg.setAttribute('viewBox', `0 0 ${svgSize} ${svgSize}`);
        svg.style.border = '1px solid black';

        // Use `transform: translate` to center the SVG
        svg.style.position = 'absolute';
        svg.style.top = '50%';
        svg.style.left = '50%';
        svg.style.transform = 'translate(-50%, -50%)';

        // Calculate SVG size and offsets for centering

        // Center the SVG viewBox
        const viewBoxX = cx - r - padding;
        const viewBoxY = cy - r - padding;
        const viewBoxSize = svgSize;

        // Create the SVG container
        svg.setAttribute('width', svgSize);
        svg.setAttribute('height', svgSize);
        svg.setAttribute(
          'viewBox',
          `${viewBoxX} ${viewBoxY} ${viewBoxSize} ${viewBoxSize}`
        );
        svg.style.border = '1px solid black';

        // Add original arc
        const { path: originalArc, textElement: originalText } = createArcPath(
          startAngle,
          endAngle,
          'blue',
          text,
          () => console.log('Original arc clicked!')
        );
        svg.appendChild(originalArc);
        svg.appendChild(originalText);

        // Add vertically mirrored arc
        const mirroredStartAngle = 180 - endAngle;
        const mirroredEndAngle = 180 - startAngle;
        const { path: mirroredArc, textElement: mirroredTextElement } =
          createArcPath(
            mirroredStartAngle,
            mirroredEndAngle,
            'red',
            mirroredText,
            () => console.log('Mirrored arc clicked!')
          );
        svg.appendChild(mirroredArc);
        svg.appendChild(mirroredTextElement);

        // Append the SVG to the parent container
        parentContainer.appendChild(svg);
      }

      const notes = [
        'a2',
        'a#2',
        'h2',
        'c3',
        'c#3',
        'd3',
        'd#3',
        'e3',
        'f3',
        'f#3',
        'g3',
        'g#3',
        'a3',
        'a#3',
        'h3',
        'c4',
        'c#4',
        'd4',
        'd#4',
        'e4',
      ];

      function createMainButton() {
        const mainExcerciseButton = document.createElement('div');
        mainExcerciseButton.id = 'mainButton';

        // Create the circle
        const circle = document.createElement('div');
        circle.id = 'circle';
        mainExcerciseButton.appendChild(circle);

        // Create the triangle
        const triangle = document.createElement('div');
        triangle.id = 'triangle';
        circle.appendChild(triangle);

        // Create the square
        const square = document.createElement('div');
        square.id = 'square';
        circle.appendChild(square);

        let blinkInterval;
        window.isPlaying = false;

        // Style the button container
        mainExcerciseButton.style.position = 'relative';
        mainExcerciseButton.style.width = '120px';
        mainExcerciseButton.style.height = mainExcerciseButton.style.width;
        mainExcerciseButton.style.borderRadius = '50%';
        // mainExcerciseButton.style.margin = 'auto 10px';
        mainExcerciseButton.style.cursor = 'pointer'; //

        // Style the circle
        circle.style.position = 'absolute';
        circle.style.width = '100%';
        circle.style.height = '100%';
        circle.style.backgroundColor = '#007bff';
        circle.style.borderRadius = '50%';
        circle.style.border = '0px solid red';
        circle.style.transition = 'background-color 1s';

        // Style the triangle
        triangle.style.position = 'absolute';
        triangle.style.top = '50%';
        triangle.style.left = '55%';
        triangle.style.transform = 'translate(-50%, -50%)';
        triangle.style.width = '0';
        triangle.style.height = '0';
        triangle.style.borderTop = '20px solid transparent';
        triangle.style.borderBottom = '20px solid transparent';
        triangle.style.borderLeft = '35px solid white';

        // Style the square
        square.style.position = 'absolute';
        square.style.top = '50%';
        square.style.left = '50%';
        square.style.transform = 'translate(-50%, -50%)';
        square.style.width = '25px';
        square.style.height = '25px';
        square.style.backgroundColor = 'white';
        square.style.display = 'none'; // Initially hidden

        return mainExcerciseButton;
      }

      // Attach the function to the global object
      window.createMainButton = createMainButton;

      function createIntervalButton(index, label) {
        const intervalButton = document.createElement('button');
        intervalButton.textContent = label;
        intervalButton.id = `intervalButton-${index}`;
        intervalButton.classList.add('interval_button');

        // Add event listener to check if the button's index matches intervalToGuess
        intervalButton.addEventListener('mouseup', () => {
          intervalButton.style.backgroundColor = ''; // Revert to default background on mouseup
        });

        const intervalButtonWrapper = document.createElement('div');
        // Create the checkbox
        // Prevent deselecting if only two checkboxes remain selected
        // Create a wrapper for button and checkbox
        intervalButtonWrapper.appendChild(intervalButton);

        // Add the wrapper to the buttonRow
        return intervalButtonWrapper;
      }

      function arrangeButtonsInDoubleClock(container, radius, spacing) {
        const firstChildren = [];
        const secondChildren = [];

        // Separate first and second children, skipping mainButton
        Array.from(container.children).forEach((child) => {
          if (child === mainButton) return; // Skip mainButton
          const [first, second] = child.children;
          if (first) firstChildren.push(first);
          if (second) secondChildren.push(second);
        });

        const arrangeCircle = (elements, radius, centerX, centerY) => {
          const numElements = elements.length;
          const angleIncrement = 360 / numElements;

          elements.forEach((element, index) => {
            const angle = index * angleIncrement - 90; // Start at "noon"
            const radians = (angle * Math.PI) / 180;

            const x = centerX + radius * Math.cos(radians);
            const y = centerY + radius * Math.sin(radians);

            // Account for the dimensions of the element to ensure proper centering
            const elementWidth = element.offsetWidth;
            const elementHeight = element.offsetHeight;

            element.style.position = 'absolute';
            element.style.left = `${x - elementWidth / 2}px`;
            element.style.top = `${y - elementHeight / 2}px`;
          });
        };

        // Calculate container center
        const containerRect = container.getBoundingClientRect();
        const containerCenterX = containerRect.width / 2;
        const containerCenterY = containerRect.height / 2;

        // Arrange children
        arrangeCircle(
          firstChildren,
          radius + spacing,
          containerCenterX,
          containerCenterY
        );
        arrangeCircle(
          secondChildren,
          radius,
          containerCenterX,
          containerCenterY
        );

        // Add a dot to indicate the center
        let theDot = document.getElementById('the_dot');
        if (!theDot) {
          theDot = document.createElement('div');
          theDot.id = 'the_dot';
          theDot.style.position = 'absolute';
          theDot.style.width = '0px';
          theDot.style.height = '0px';
          theDot.style.borderRadius = '50%';
          theDot.style.transform = 'translate(-50%, -50%)'; // Center precisely
          container.appendChild(theDot);
        }
        theDot.style.left = `${containerCenterX}px`;
        theDot.style.top = `${containerCenterY}px`;
      }

      function adjustContainerSize(container) {
        let minX = Infinity,
          minY = Infinity,
          maxX = -Infinity,
          maxY = -Infinity;

        // Collect all second-level children (positioned elements)
        const elements = [];
        Array.from(container.children).forEach((child) => {
          if (child !== mainButton) elements.push(...child.children);
        });

        // Calculate bounding box for elements
        elements.forEach((element) => {
          const rect = element.getBoundingClientRect();
          const containerRect = container.getBoundingClientRect();

          const relativeLeft = rect.left - containerRect.left;
          const relativeTop = rect.top - containerRect.top;
          const relativeRight = rect.right - containerRect.left;
          const relativeBottom = rect.bottom - containerRect.top;

          minX = Math.min(minX, relativeLeft);
          minY = Math.min(minY, relativeTop);
          maxX = Math.max(maxX, relativeRight);
          maxY = Math.max(maxY, relativeBottom);
        });

        // Adjust container size
        container.style.width = `${maxX - minX}px`;
        container.style.height = `${maxY - minY}px`;

        // Calculate new center
        const newCenterX = (maxX - minX) / 2;
        const newCenterY = (maxY - minY) / 2;

        // Move all second-level children and the dot
        const theDot = document.getElementById('the_dot');
        if (theDot) {
          const oldLeft = parseFloat(theDot.style.left || 0);
          const oldTop = parseFloat(theDot.style.top || 0);
          const offsetX = newCenterX - oldLeft;
          const offsetY = newCenterY - oldTop;

          // Move dot
          theDot.style.left = `${newCenterX}px`;
          theDot.style.top = `${newCenterY}px`;

          // Move elements
          elements.forEach((element) => {
            const currentLeft = parseFloat(element.style.left || 0);
            const currentTop = parseFloat(element.style.top || 0);
            element.style.left = `${currentLeft + offsetX}px`;
            element.style.top = `${currentTop + offsetY}px`;
          });
        }
      }

      window.buttonLabels = [
        '1cz',
        '2m',
        '2w',
        '3m',
        '3w',
        '4cz',
        'Try',
        '5cz',
        '6m',
        '6w',
        '7m',
        '7w',
        '8cz',
      ];

      // PRZYCISKI INTERWAŁÓW
      const intervalButtonsContainer = document.createElement('div');
      intervalButtonsContainer.id = 'interval_buttons_container';

      // Use the global function to create and add the interval button
      const mainButton = createMainButton();
      mainButton.style.left = '50%';
      mainButton.style.top = '50%';
      mainButton.style.transform = 'translate(-50%, -50%)';

      intervalButtonsContainer.appendChild(mainButton);

      buttonLabels.forEach((label, index) => {
        const elementIntervalButton = createIntervalButton(index, label);
        intervalButtonsContainer.appendChild(elementIntervalButton);
      });

      // Append the button row to the "kontrolki" div
      const kontrolki = document.getElementById('kontrolki');
      kontrolki.appendChild(intervalButtonsContainer);
      kontrolki.style.position = 'relative';

      const container = document.getElementById('interval_buttons_container');
      arrangeButtonsInDoubleClock(container, 140, 90); // Arrange elements
      adjustContainerSize(container); // Adjust elements after resizing

      addArcSegmentWithMirror(
        container,
        container.getBoundingClientRect().width / 2,
        container.getBoundingClientRect().height / 2,
        container.getBoundingClientRect().height / 4,
        -30,
        30,
        50,
        'Dalej',
        'ABC'
      );
    </script>
  </body>
</html>
