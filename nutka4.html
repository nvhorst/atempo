<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Tones</title>
</head>
<body>
    <div id="nav">
        <input type="radio" name="demo" id="piano">Piano</input>
    </div>
    <script>
        (function(window) {
            var tones = {
                context: new (window.AudioContext || window.webkitAudioContext)(),
                attack: 1,
                release: 100,
                volume: 1,
                type: "sine",

                playFrequency: function(freq) {
                    this.attack = this.attack || 1;
                    this.release = this.release || 1;
                    var envelope = this.context.createGain();
                    envelope.gain.setValueAtTime(this.volume, this.context.currentTime);
                    envelope.connect(this.context.destination);

                    envelope.gain.setValueAtTime(0, this.context.currentTime);
                    envelope.gain.setTargetAtTime(this.volume, this.context.currentTime, this.attack / 1000);
                    if (this.release) {
                        envelope.gain.setTargetAtTime(0, this.context.currentTime + this.attack / 1000, this.release / 1000);
                        setTimeout(function() {
                            osc.stop();
                            osc.disconnect(envelope);
                            envelope.gain.cancelScheduledValues(tones.context.currentTime);
                            envelope.disconnect(tones.context.destination);
                        }, this.attack * 10 + this.release * 10);
                    }

                    var osc = this.context.createOscillator();
                    osc.frequency.setValueAtTime(freq, this.context.currentTime);
                    osc.type = this.type;
                    osc.connect(envelope);
                    osc.start();
                },

                play: function(freqOrNote, octave) {
                    if (typeof freqOrNote === "number") {
                        this.playFrequency(freqOrNote);
                    } else if (typeof freqOrNote === "string") {
                        if (octave == null) {
                            octave = 4;
                        }
                        this.playFrequency(this.map[octave][freqOrNote.toLowerCase()]);
                    }
                },

                map: [
                    // Simplified map for octaves 3, 4, and 5
                    {
                        "c": 130.813, "c#": 138.591, "d": 146.832, "e": 164.814, "f": 174.614,
                        "f#": 184.997, "g": 195.998, "g#": 207.652, "a": 220, "a#": 233.082,
                        "b": 246.942
                    },
                    {
                        "c": 261.626, "c#": 277.183, "d": 293.665, "e": 329.628, "f": 349.228,
                        "f#": 369.994, "g": 391.995, "g#": 415.305, "a": 440, "a#": 466.164,
                        "b": 493.883
                    },
                    {
                        "c": 523.251, "c#": 554.365, "d": 587.33, "e": 659.255, "f": 698.456,
                        "f#": 739.989, "g": 783.991, "g#": 830.609, "a": 880, "a#": 932.328,
                        "b": 987.767
                    }
                ]
            };

            tones.context.createGain();
            window.tones = tones;
        })(window);

        function piano() {
            tones.attack = 0;
            tones.release = 300;
            tones.type = "sawtooth";

            const notes = ["c", "d", "e", "f", "g", "a", "b"];

            // Main keyboard
            for (let i = 0; i < 7; i++) {
                makeKey(100 + i * 100, 200, 100, 500, "white", notes[i], 4);
            }

            // Five keys above
            const aboveNotes = ["c", "d", "e", "f", "g"];
            for (let i = 0; i < aboveNotes.length; i++) {
                makeKey(100 + i * 100, 50, 100, 150, "blue", aboveNotes[i], 5);
            }

            // Five keys below
            const belowNotes = ["a", "b", "c", "d", "e"];
            for (let i = 0; i < belowNotes.length; i++) {
                makeKey(100 + i * 100, 750, 100, 150, "green", belowNotes[i], 3);
            }

            function makeKey(x, y, width, height, color, note, octave) {
                const key = document.createElement("div");
                key.style.width = `${width}px`;
                key.style.height = `${height}px`;
                key.style.position = "absolute";
                key.style.left = `${x}px`;
                key.style.top = `${y}px`;
                key.style.backgroundColor = color;
                key.style.border = "solid 1px black";
                key.note = note;
                key.octave = octave;

                key.addEventListener("mousedown", function(event) {
                    const note = event.target.note;
                    const octave = event.target.octave;

                    // Play the main note
                    tones.play(note, octave);

                    // Play the sibling note
                    const siblingIndex = (notes.indexOf(note) + 1) % notes.length; // Wrap around
                    const siblingNote = notes[siblingIndex];
                    tones.play(siblingNote, octave);
                });

                document.body.appendChild(key);
            }
        }

        piano();
    </script>
</body>
</html>
