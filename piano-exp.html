<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <title>Tones</title>
    <link rel="stylesheet" href="nutka.css" />
  </head>
  <body>
    <div id="zadania"></div>
    <div id="piano"></div>

    <script>
      var keys = {};
      window.keys = keys; // Attach keys to the global window object

      function piano() {
        const pianoDiv = document.getElementById('piano');

        const attackColor = 'lawngreen';

        const notes = [
          'a2',
          'h2',
          'c3',
          'd3',
          'e3',
          'f3',
          'g3',
          'a3',
          'h3',
          'c4',
          'd4',
          'e4',
        ];
        const black_notes = ['c', 'd', 'f', 'g', 'a'];
        const margin = 0;
        const white_key_width =
          (0.5 * window.innerWidth) / (notes.length + margin * 2);
        const white_key_height = 5 * white_key_width;
        const black_key_width = 0.6 * white_key_width;
        const black_key_height = 0.6 * white_key_height;

        pianoDiv.style.height = `${white_key_height + 40}px`;

        const keysContainer = document.createElement('div');
        keysContainer.style.position = 'relative';
        keysContainer.style.height = `${white_key_height}px`;
        keysContainer.style.width = `${white_key_width * notes.length}px`;
        keysContainer.style.margin = '0 auto'; // Center the keys container
        pianoDiv.appendChild(keysContainer);

        for (let i = 0; i < notes.length; i++) {
          const key = makeKey(
            white_key_width * i,
            0,
            white_key_width,
            white_key_height,
            'white',
            notes[i]
          );
          keys[notes[i]] = key;
          keysContainer.appendChild(key);
        }

        notes.forEach((element, count) => {
          if (count < notes.length - 1 && black_notes.includes(element[0])) {
            const key = makeKey(
              white_key_width * (count + 1) - black_key_width * 0.5,
              0,
              black_key_width,
              black_key_height,
              'black',
              element[0] + '#' + element[1]
            );
            keys[element[0] + '#' + element[1]] = key;
            keysContainer.appendChild(key);
          }
        });

        // Add slider directly below the keyboard
        const slider = document.createElement('input');
        slider.style.padding = 0;
        slider.style.margin = 0;
        slider.type = 'range';
        slider.min = '0';
        slider.max = '22';
        slider.value = '0';
        slider.style.width = `${white_key_width * (notes.length - 1)}px`; // Match keyboard width
        slider.style.position = 'absolute';
        slider.style.top = `${white_key_height}px`; // Position directly below the keyboard
        slider.style.left = '50%'; // Center horizontally
        slider.style.transform = 'translateX(-50%)'; // Adjust for the width
        pianoDiv.appendChild(slider);

        function makeKey(x, y, width, height, color, note) {
          const key = document.createElement('div');
          key.style.width = `${width}px`;
          key.style.height = `${height}px`;
          key.style.position = 'absolute';
          key.style.left = `${x}px`;
          key.style.top = `${y}px`;
          key.style.backgroundColor = color;
          key.style.border = 'solid 1px black';
          key.style.transition = 'background-color 0.5s ease';
          key.note = note;

          key.addEventListener('mousedown', function (event) {
            key.style.backgroundColor = attackColor;
            setTimeout(() => {
              key.style.backgroundColor = color;
            }, 300);
          });

          return key;
        }
      }
      piano();
    </script>
  </body>
</html>
